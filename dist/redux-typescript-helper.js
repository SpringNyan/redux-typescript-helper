!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs/operators"),require("rxjs"),require("redux-observable"),require("immer"),require("reselect")):"function"==typeof define&&define.amd?define(["rxjs/operators","rxjs","redux-observable","immer","reselect"],t):"object"==typeof exports?exports["redux-typescript-helper"]=t(require("rxjs/operators"),require("rxjs"),require("redux-observable"),require("immer"),require("reselect")):e["redux-typescript-helper"]=t(e["rxjs/operators"],e.rxjs,e["redux-observable"],e.immer,e.reselect)}(window,function(e,t,r,n,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,r){"use strict";r.r(t);var n={register:"@@REGISTER",epicEnd:"@@EPIC_END",unregister:"@@UNREGISTER"};function o(e){return null!=e&&e.type===this.type}function i(e){var t=function(t){return{type:e,payload:t}};return t.type=e,t.is=o,t}function s(e,t,r){var n={$namespace:t.join("/"),$parent:r};n.$root=null!=r?r.$root:n,n.$child=function(e){return n[e]};for(var o=0,c=Object.keys(e.reducers).concat(Object.keys(e.effects));o<c.length;o++){var u=c[o];n[u]=i(t.concat([u]).join("/"))}for(var l=0,a=Object.keys(e.models);l<a.length;l++){u=a[l];n[u]=s(e.models[u],t.concat([u]),n)}return n}var c=r(1),u=r(0),l=r(2);function a(e,t,r){return t.reduce(function(e,t){return null!=e?r?r(e,t):e[t]:void 0},e)}function p(e,t){return e.startsWith?e.startsWith(t):0===e.lastIndexOf(t,0)}function d(e){return new c.Observable(function(t){e(function(e){return t.next(e),e}).then(function(){return t.complete()},function(e){return t.error(e)})})}function f(e,t,r,o){return function(i,s){var f=o.join("/"),h="/"+n.unregister,_=i.pipe(Object(u.filter)(function(e){return"string"==typeof e.type&&function(e,t){if(e.endsWith)return e.endsWith(t);var r=e.length-t.length;return r>=0&&e.lastIndexOf(t,r)===r}(e.type,h)&&p(f,e.type.substring(0,e.type.length-h.length))}));return c.merge.apply(void 0,function e(t,r,n,o,i){var s=[];for(var f=0,h=Object.keys(t.models);f<h.length;f++){var _=h[f],y=t.models[_],b=e(y,r,n,o,i.concat([_]));s.push.apply(s,b)}var m=new l.StateObservable(o.pipe(Object(u.map)(function(e){return a(e,i)}),Object(u.distinctUntilChanged)()),a(o.value,i));var g=a(r.$storeHelper,i,function(e,t){return e.$child(t)});var v=g.actions;var j=g.getters;var O=function(e){var l,a=u.mergeMap,p=t.effects[e];Array.isArray(p)?(l=p[0],a=p[1]):l=p;var f=n.ofType(i.concat([e]).join("/")),h=f.pipe(a(function(e){var t=e.payload,i=l({action$:f,rootAction$:n,state$:m,rootState$:o,helper:g,actions:v,getters:j,dependencies:r},t);return Object(c.isObservable)(i)?i:d(i)}));s.push(h)};for(var $=0,x=Object.keys(t.effects);$<x.length;$++){var _=x[$];O(_)}var S=i.join("/")+"/";for(var w=0,E=t.epics;w<E.length;w++){var H=E[w],M=new l.ActionsObservable(n.pipe(Object(u.filter)(function(e){return"string"==typeof e.type&&p(e.type,S)}))),P=H({action$:M,rootAction$:n,state$:m,rootState$:o,helper:g,actions:v,getters:j,dependencies:r});s.push(P)}return s}(e,t,i,s,o).map(function(e){return null!=r?e.pipe(Object(u.catchError)(r)):e})).pipe(Object(u.takeUntil)(_))}}var h=function(){return(h=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},_=function(){function e(e){this._isFrozen=!1,this._model=m(e)}return e.prototype.dependencies=function(){return this._isFrozen?this.clone().dependencies():this},e.prototype.state=function(e){if(this._isFrozen)return this.clone().state(e);var t=this._model.state,r=y(e);return this._model.state=null==t?r:function(e){return h({},t(e),r(e))},this},e.prototype.selectors=function(e){if(this._isFrozen)return this.clone().selectors(e);var t=this._model.selectors,r=y(e);return this._model.selectors=function(e){return h({},t(e),r(e))},this},e.prototype.reducers=function(e){return this._isFrozen?this.clone().reducers(e):(this._model.reducers=h({},this._model.reducers,e),this)},e.prototype.effects=function(e){return this._isFrozen?this.clone().effects(e):(this._model.effects=h({},this._model.effects,e),this)},e.prototype.epics=function(e){return this._isFrozen?this.clone().epics(e):(this._model.epics=this._model.epics.concat(e),this)},e.prototype.models=function(e){return this._isFrozen?this.clone().models(e):(this._model.models=h({},this._model.models,e),this)},e.prototype.dynamicModels=function(){return this._isFrozen?this.clone().dynamicModels():this},e.prototype.build=function(){if(null==this._model.state)throw new Error("state is not defined");return m(this._model)},e.prototype.clone=function(){return new e(this._model)},e.prototype.freeze=function(){return this._isFrozen=!0,this},e}();function y(e){return"function"==typeof e?e:function(){return e}}function b(){return new _({state:void 0,selectors:function(){return{}},reducers:{},effects:{},epics:[],models:{}})}function m(e){return{state:e.state,selectors:e.selectors,reducers:h({},e.reducers),effects:h({},e.effects),epics:e.epics.slice(),models:h({},e.models)}}var g=r(3),v=r.n(g),j=function(){return(j=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function O(e,t){return function(r,o){return r=function e(t,r,n){void 0===t&&(t=r.state(n));var o=!1;var i={};for(var s=0,c=Object.keys(r.models);s<c.length;s++){var u=c[s],l=r.models[u],a=e(t[u],l,n);t[u]!==a&&(i[u]=a,o=!0)}return o?j({},t,i):t}(r,e,t),v()(r,function(r){var i=o.type.split("/"),s=a(r,i.slice(0,i.length-2)),c=a(e,i.slice(0,i.length-1),function(e,t){return e.models[t]}),u=i[i.length-2],l=i[i.length-1];l===n.unregister&&null!=s&&null!=u&&delete s[u];var p=null!=s&&null!=u?s[u]:void 0,d=null!=c?c.reducers[l]:void 0;if(null!=d){if(null==s||null==u)throw new Error("state not found");var f=d(p,o.payload,t);void 0!==f&&(s[u]=f)}})}}var $=r(4);function x(e,t,r,n){var o={get state(){return a(t.$store.getState(),r)},$namespace:r.join("/"),$parent:n};o.$root=null!=n?n.$root:o,o.$child=function(e){return o[e]};for(var i=e.selectors($.createSelector),s=function(e){Object.defineProperty(o,e,{get:function(){return i[e]({get state(){return o.state},get rootState(){return o.$root.state},getters:o,dependencies:t})},enumerable:!0,configurable:!0})},c=0,u=Object.keys(i);c<u.length;c++){s(d=u[c])}for(var l=0,p=Object.keys(e.models);l<p.length;l++){var d=p[l];o[d]=x(e.models[d],t,r.concat([d]),o)}return o}var S=function(){function e(e,t,r){var n=this;this._model=t,this._options=r,this._dependencies={};for(var o=function(t){Object.defineProperty(i._dependencies,t,{get:function(){return e[t]},enumerable:!0,configurable:!0})},i=this,l=0,a=Object.keys(e);l<a.length;l++){o(a[l])}this._actions=s(this._model,[],null),this._getters=x(this._model,this._dependencies,[],null),this._storeHelper=new E(this._model,this._dependencies,this._options,this._actions,this._getters,function(e){return n._addEpic$.next(e)},[],null),this._dependencies.$storeHelper=this._storeHelper,this._reducer=O(this._model,this._dependencies);var p=f(t,this._dependencies,this._options.epicErrorHandler||null,[]);this._addEpic$=new c.BehaviorSubject(p),this._epic=function(e,t,r){return n._addEpic$.pipe(Object(u.mergeMap)(function(n){return n(e,t,r)}))}}return Object.defineProperty(e.prototype,"reducer",{get:function(){return this._reducer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epic",{get:function(){return this._epic},enumerable:!0,configurable:!0}),e.prototype.create=function(e){if(null!=this._store)throw new Error("store helper is already created");return this._store=e,this._dependencies.$store=this._store,this._storeHelper},e}();function w(e,t,r){return null==r&&(r={}),new S(e,t,r)}var E=function(){function e(e,t,r,n,o,i,s,c){this._subStoreHelpers={},this._model=e,this._dependencies=t,this._options=r,this._actions=n,this._getters=o,this._addEpic=i,this._namespaces=s,this.$namespace=s.join("/"),this.$parent=c,this.$root=null!=c?c.$root:this;for(var u=0,l=Object.keys(e.models);u<l.length;u++){var a=l[u];this._registerSubStoreHelper(a)}}return Object.defineProperty(e.prototype,"state",{get:function(){return a(this._store.getState(),this._namespaces)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getters",{get:function(){return this._getters},enumerable:!0,configurable:!0}),e.prototype.$child=function(e){var t=this._subStoreHelpers[e];return null!=t?t:null},e.prototype.$registerModel=function(e,t){if(null!=this._model.models[e])throw new Error("model is already registered");this._model.models[e]=t;var r=this._namespaces.concat([e]);this._actions[e]=s(t,r,this._actions),this._getters[e]=x(t,this._dependencies,r,this._getters),this._registerSubStoreHelper(e),this._addEpic(f(t,this._dependencies,this._options.epicErrorHandler||null,r)),this._store.dispatch({type:r.join("/")+"/"+n.register})},e.prototype.$unregisterModel=function(e){if(null==this._model.models[e])throw new Error("model is already unregistered");var t=this._namespaces.concat([e]);this._store.dispatch({type:t.join("/")+"/"+n.epicEnd}),this._unregisterSubStoreHelper(e),delete this._actions[e],delete this._getters[e],this._store.dispatch({type:t.join("/")+"/"+n.unregister}),delete this._model.models[e]},Object.defineProperty(e.prototype,"_store",{get:function(){return this._dependencies.$store},enumerable:!0,configurable:!0}),e.prototype._registerSubStoreHelper=function(t){var r=this;this._subStoreHelpers[t]=new e(this._model.models[t],this._dependencies,this._options,this._actions[t],this._getters[t],this._addEpic,this._namespaces.concat([t]),this),Object.defineProperty(this,t,{get:function(){return r.$child(t)},enumerable:!0,configurable:!0})},e.prototype._unregisterSubStoreHelper=function(e){delete this[e],delete this._subStoreHelpers[e]},e}();r.d(t,"actionTypes",function(){return n}),r.d(t,"createActionHelper",function(){return i}),r.d(t,"createModelActionHelpers",function(){return s}),r.d(t,"toAction$",function(){return d}),r.d(t,"createModelEpic",function(){return f}),r.d(t,"ModelBuilder",function(){return _}),r.d(t,"createModelBuilder",function(){return b}),r.d(t,"cloneModel",function(){return m}),r.d(t,"createModelReducer",function(){return O}),r.d(t,"createModelGetters",function(){return x}),r.d(t,"StoreHelperFactory",function(){return S}),r.d(t,"createStoreHelperFactory",function(){return w})}])});