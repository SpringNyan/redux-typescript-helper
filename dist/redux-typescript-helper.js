!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs/operators"),require("rxjs"),require("redux-observable"),require("immer"),require("reselect")):"function"==typeof define&&define.amd?define(["rxjs/operators","rxjs","redux-observable","immer","reselect"],t):"object"==typeof exports?exports["redux-typescript-helper"]=t(require("rxjs/operators"),require("rxjs"),require("redux-observable"),require("immer"),require("reselect")):e["redux-typescript-helper"]=t(e["rxjs/operators"],e.rxjs,e["redux-observable"],e.immer,e.reselect)}(window,function(e,t,r,n,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,r){"use strict";r.r(t);var n=new(function(){function e(){this._itemMap=new Map}return e.prototype.setDispatched=function(e){var t=this._itemMap.get(e);null!=t&&(t.hasDispatched=!0)},e.prototype.hasDispatched=function(e){var t=this._itemMap.get(e);return null!=t&&t.hasDispatched},e.prototype.resolve=function(e){var t=this._itemMap.get(e);null!=t&&(t.resolve(),this._itemMap.delete(e))},e.prototype.reject=function(e,t){var r=this._itemMap.get(e);null!=r&&(r.reject(t),this._itemMap.delete(e))},e.prototype.register=function(e){var t=this;return new Promise(function(r,n){t._itemMap.set(e,{hasDispatched:!1,resolve:r,reject:n})})},e}()),o={register:"@@REGISTER",epicEnd:"@@EPIC_END",unregister:"@@UNREGISTER"};function i(e){return null!=e&&e.type===this.type}function s(e,t){var r=function(t){return{type:e,payload:t}};return r.type=e,r.is=i,r.dispatch=function(e,o){var i=r(e),s=n.register(i);return(o||t)(i),n.hasDispatched(i)||n.resolve(i),s},r}function c(e,t,r,n){var o={$namespace:r.join("/"),$parent:n};o.$root=null!=n?n.$root:o,o.$child=function(e){return o[e]};for(var i=function(e){return t.$store.dispatch(e)},u=0,l=Object.keys(e.reducers).concat(Object.keys(e.effects));u<l.length;u++){var a=l[u];o[a]=s(r.concat([a]).join("/"),i)}for(var p=0,d=Object.keys(e.models);p<d.length;p++){a=d[p];o[a]=c(e.models[a],t,r.concat([a]),o)}return o}var u=r(1),l=r(0),a=r(2);function p(e,t,r){return t.reduce(function(e,t){return null!=e?r?r(e,t):e[t]:void 0},e)}function d(e,t){return e.startsWith?e.startsWith(t):0===e.lastIndexOf(t,0)}function f(e){return new u.Observable(function(t){e(function(e){return t.next(e),e}).then(function(){return t.complete()},function(e){return t.error(e)})})}function h(e,t,r,i){return function(s,c){var h=i.join("/"),_="/"+o.unregister,m=s.pipe(Object(l.filter)(function(e){return"string"==typeof e.type&&function(e,t){if(e.endsWith)return e.endsWith(t);var r=e.length-t.length;return r>=0&&e.lastIndexOf(t,r)===r}(e.type,_)&&d(h,e.type.substring(0,e.type.length-_.length))}));return u.merge.apply(void 0,function e(t,r,o,i,s){var c=[];for(var u=0,h=Object.keys(t.models);u<h.length;u++){var _=h[u],m=t.models[_],y=e(m,r,o,i,s.concat([_]));c.push.apply(c,y)}var b=new a.StateObservable(i.pipe(Object(l.map)(function(e){return p(e,s)}),Object(l.distinctUntilChanged)()),p(i.value,s));var g=p(r.$storeHelper,s,function(e,t){return e.$child(t)});var v=g.actions;var j=g.getters;var O=function(e){var u=t.effects[e],a=o.ofType(s.concat([e]).join("/")),p=a.pipe(Object(l.mergeMap)(function(e){n.setDispatched(e);var t=e.payload,s=u({action$:a,rootAction$:o,state$:b,rootState$:i,helper:g,actions:v,getters:j,dependencies:r},t);return f(function(t){var r=s(t);return r.then(function(){n.resolve(e)},function(t){n.reject(e,t)}),r})}));c.push(p)};for(var $=0,x=Object.keys(t.effects);$<x.length;$++){var _=x[$];O(_)}var S=s.join("/")+"/";for(var w=0,M=t.epics;w<M.length;w++){var E=M[w],H=new a.ActionsObservable(o.pipe(Object(l.filter)(function(e){return"string"==typeof e.type&&d(e.type,S)}))),P=E({action$:H,rootAction$:o,state$:b,rootState$:i,helper:g,actions:v,getters:j,dependencies:r});c.push(P)}return c}(e,t,s,c,i).map(function(e){return null!=r?e.pipe(Object(l.catchError)(r)):e})).pipe(Object(l.takeUntil)(m))}}var _=function(){return(_=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},m=function(){function e(e){this._isFrozen=!1,this._model=g(e)}return e.prototype.dependencies=function(){return this._isFrozen?this.clone().dependencies():this},e.prototype.state=function(e){if(this._isFrozen)return this.clone().state(e);var t=this._model.state,r=y(e);return this._model.state=null==t?r:function(e){return _({},t(e),r(e))},this},e.prototype.selectors=function(e){if(this._isFrozen)return this.clone().selectors(e);var t=this._model.selectors,r=y(e);return this._model.selectors=function(e){return _({},t(e),r(e))},this},e.prototype.reducers=function(e){return this._isFrozen?this.clone().reducers(e):(this._model.reducers=_({},this._model.reducers,e),this)},e.prototype.effects=function(e){return this._isFrozen?this.clone().effects(e):(this._model.effects=_({},this._model.effects,e),this)},e.prototype.epics=function(e){return this._isFrozen?this.clone().epics(e):(this._model.epics=this._model.epics.concat(e),this)},e.prototype.models=function(e){return this._isFrozen?this.clone().models(e):(this._model.models=_({},this._model.models,e),this)},e.prototype.dynamicModels=function(){return this._isFrozen?this.clone().dynamicModels():this},e.prototype.build=function(){if(null==this._model.state)throw new Error("state is not defined");return g(this._model)},e.prototype.clone=function(){return new e(this._model)},e.prototype.freeze=function(){return this._isFrozen=!0,this},e}();function y(e){return"function"==typeof e?e:function(){return e}}function b(){return new m({state:void 0,selectors:function(){return{}},reducers:{},effects:{},epics:[],models:{}})}function g(e){return{state:e.state,selectors:e.selectors,reducers:_({},e.reducers),effects:_({},e.effects),epics:e.epics.slice(),models:_({},e.models)}}var v=r(3),j=r.n(v),O=function(){return(O=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function $(e,t){return function(r,n){return r=function e(t,r,n){void 0===t&&(t=r.state(n));var o=!1;var i={};for(var s=0,c=Object.keys(r.models);s<c.length;s++){var u=c[s],l=r.models[u],a=e(t[u],l,n);t[u]!==a&&(i[u]=a,o=!0)}return o?O({},t,i):t}(r,e,t),j()(r,function(t){var i=n.type.split("/"),s=p(t,i.slice(0,i.length-2)),c=p(e,i.slice(0,i.length-1),function(e,t){return e.models[t]}),u=i[i.length-2],l=i[i.length-1];l===o.unregister&&null!=s&&null!=u&&delete s[u];var a=null!=s&&null!=u?s[u]:void 0,d=null!=c?c.reducers[l]:void 0;if(null!=d){if(null==s||null==u)throw new Error("state not found");var f=p(r,i.slice(0,i.length-1)),h=d(a,n.payload,f);void 0!==h&&(s[u]=h)}})}}var x=r(4);function S(e,t,r,n){var o={get state(){return p(t.$store.getState(),r)},$namespace:r.join("/"),$parent:n};o.$root=null!=n?n.$root:o,o.$child=function(e){return o[e]};for(var i=e.selectors(x.createSelector),s=function(e){Object.defineProperty(o,e,{get:function(){return i[e]({get state(){return o.state},get rootState(){return o.$root.state},getters:o,dependencies:t})},enumerable:!0,configurable:!0})},c=0,u=Object.keys(i);c<u.length;c++){s(d=u[c])}for(var l=0,a=Object.keys(e.models);l<a.length;l++){var d=a[l];o[d]=S(e.models[d],t,r.concat([d]),o)}return o}var w=function(){function e(e,t,r){var n=this;this._model=t,this._options=r,this._dependencies={};for(var o=function(t){Object.defineProperty(i._dependencies,t,{get:function(){return e[t]},enumerable:!0,configurable:!0})},i=this,s=0,a=Object.keys(e);s<a.length;s++){o(a[s])}this._actions=c(this._model,this._dependencies,[],null),this._getters=S(this._model,this._dependencies,[],null),this._storeHelper=new E(this._model,this._dependencies,this._options,this._actions,this._getters,function(e){return n._addEpic$.next(e)},[],null),this._dependencies.$storeHelper=this._storeHelper,this._reducer=$(this._model,this._dependencies);var p=h(t,this._dependencies,this._options.epicErrorHandler||null,[]);this._addEpic$=new u.BehaviorSubject(p),this._epic=function(e,t,r){return n._addEpic$.pipe(Object(l.mergeMap)(function(n){return n(e,t,r)}))}}return Object.defineProperty(e.prototype,"reducer",{get:function(){return this._reducer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epic",{get:function(){return this._epic},enumerable:!0,configurable:!0}),e.prototype.create=function(e){if(null!=this._store)throw new Error("store helper is already created");return this._store=e,this._dependencies.$store=this._store,this._storeHelper},e}();function M(e,t,r){return null==r&&(r={}),new w(e,t,r)}var E=function(){function e(e,t,r,n,o,i,s,c){this._subStoreHelpers={},this._model=e,this._dependencies=t,this._options=r,this._actions=n,this._getters=o,this._addEpic=i,this._namespaces=s,this.$namespace=s.join("/"),this.$parent=c,this.$root=null!=c?c.$root:this;for(var u=0,l=Object.keys(e.models);u<l.length;u++){var a=l[u];this._registerSubStoreHelper(a)}}return Object.defineProperty(e.prototype,"state",{get:function(){return p(this._store.getState(),this._namespaces)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getters",{get:function(){return this._getters},enumerable:!0,configurable:!0}),e.prototype.$child=function(e){var t=this._subStoreHelpers[e];return null!=t?t:null},e.prototype.$registerModel=function(e,t){if(null!=this._model.models[e])throw new Error("model is already registered");this._model.models[e]=t;var r=this._namespaces.concat([e]);this._actions[e]=c(t,this._dependencies,r,this._actions),this._getters[e]=S(t,this._dependencies,r,this._getters),this._registerSubStoreHelper(e),this._addEpic(h(t,this._dependencies,this._options.epicErrorHandler||null,r)),this._store.dispatch({type:r.join("/")+"/"+o.register})},e.prototype.$unregisterModel=function(e){if(null==this._model.models[e])throw new Error("model is already unregistered");var t=this._namespaces.concat([e]);this._store.dispatch({type:t.join("/")+"/"+o.epicEnd}),this._unregisterSubStoreHelper(e),delete this._actions[e],delete this._getters[e],this._store.dispatch({type:t.join("/")+"/"+o.unregister}),delete this._model.models[e]},Object.defineProperty(e.prototype,"_store",{get:function(){return this._dependencies.$store},enumerable:!0,configurable:!0}),e.prototype._registerSubStoreHelper=function(t){var r=this;this._subStoreHelpers[t]=new e(this._model.models[t],this._dependencies,this._options,this._actions[t],this._getters[t],this._addEpic,this._namespaces.concat([t]),this),Object.defineProperty(this,t,{get:function(){return r.$child(t)},enumerable:!0,configurable:!0})},e.prototype._unregisterSubStoreHelper=function(e){delete this[e],delete this._subStoreHelpers[e]},e}();r.d(t,"actionDispatchCallback",function(){return n}),r.d(t,"actionTypes",function(){return o}),r.d(t,"createActionHelper",function(){return s}),r.d(t,"createModelActionHelpers",function(){return c}),r.d(t,"toActionObservable",function(){return f}),r.d(t,"createModelEpic",function(){return h}),r.d(t,"ModelBuilder",function(){return m}),r.d(t,"createModelBuilder",function(){return b}),r.d(t,"cloneModel",function(){return g}),r.d(t,"createModelReducer",function(){return $}),r.d(t,"createModelGetters",function(){return S}),r.d(t,"StoreHelperFactory",function(){return w}),r.d(t,"createStoreHelperFactory",function(){return M})}])});